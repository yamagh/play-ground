# アーキテクチャガイドライン

このドキュメントでは、このリポジトリの基本的な構造、設計思想、共通仕様などを定義しています。
システムの目的や品質属性、技術的な制約などを包括的に示し、一貫性のある高品質なシステム構築を支援することを目的としています。

1. 構造: システムの主要な構成要素とその相互関係、アーキテクチャパターンなどを定めます。
2. ルールと指針: 開発のルール、コーディング規約、技術スタックの選定基準、運用におけるベストプラクティスなどが含まれます。

## 1. 構造

本システムは、サーバーサイドに **Play Framework**、クライアントサイドに **Svelte** を採用したWebアプリケーションです。両者はREST APIを介して疎結合に連携します。

### 1.1. サーバーサイド (Play Framework)

Play Frameworkの標準的なMVCアーキテクチャパターンに従います。

-   **`app/controllers`**: HTTPリクエストを受け取り、適切なレスポンスを返す責務を持ちます。
    -   `api/`: Svelteフロントエンドと通信するためのREST APIコントローラーを配置します。
    -   `web/`: サーバーサイドでHTMLをレンダリングする従来のWebコントローラーを配置します。
-   **`app/models`**: アプリケーションのデータモデルとビジネスロジックを定義します。Ebean ORMを利用してデータベースとの永続化を行います。
-   **`app/repository`**: データベースへのアクセスロジックをカプセル化し、コントローラーやサービスから利用します。
-   **`app/services`**: ビジネスロジックを実装し、コントローラーとリポジトリの仲介役を担います。
-   **`conf/routes`**: アプリケーションのルーティングを定義します。HTTPメソッドとURIパターンをコントローラーのアクションにマッピングします。

### 1.2. フロントエンド (Svelte)

コンポーネントベースアーキテクチャを採用し、UIを再利用可能な部品の組み合わせとして構築します。

-   **`app/assets/svelte`**: フロントエンドのソースコードを格納します。
    -   `screens`: 各ページに対応するトップレベルのコンポーネントを配置します。
        - `<画面名>`: 各画面ごとにディレクトリを分け、その中に画面固有のコンポーネントやスタイルを配置します。
          - `Page.svelte`: 画面のルートコンポーネント。
          - `api.ts`: その画面で利用するAPIクライアント。  
    -   `components`: 複数のページやコンポーネントで再利用される汎用的なUIコンポーネントを配置します。
    -   `stores`: アプリケーション全体で共有される状態（グローバルステート）を管理します。
    -   `utils`: APIクライアントなど、アプリケーション全体で利用されるユーティリティ関数を配置します。

### 1.3. ビルドと資材配置

-   サーバーサイドのコードは `sbt` によってコンパイルされます。
-   フロントエンドのコード（Svelte, TypeScript）は `webpack` によってバンドルされ、`public` ディレクトリ配下に配置されます。Play Frameworkはこれらの静的資材を配信します。

## 2. ルールと指針

### 2.1. コーディング規約

-   **Scala/Java**: [Play Frameworkの標準的なコーディングスタイル]()に従います。
-   **TypeScript/Svelte**: [Svelteの公式スタイルガイド]()を基本とし、プロジェクト固有のルールは別途定めます。Prettierによるコードフォーマットを必須とします。

### 2.2. API設計

-   フロントエンドとサーバーサイド間の通信は、原則としてJSON形式のRESTful APIで行います。
-   APIエンドポイントの設計は `conf/routes` に集約し、[OpenAPI (Swagger)](https://swagger.io/specification/) 仕様に準拠することを推奨します。

### 2.3. データベースの変更

-   データベーススキーマの変更は、Play Evolutions (`conf/evolutions/default/*.sql`) を用いて管理します。
-   破壊的な変更（カラムの削除や型変更など）を行う場合は、後方互換性を考慮し、慎重に計画・実施してください。

### 2.4. テスト

-   サーバーサイドのロジックには、`sbt test` で実行可能な単体テスト・結合テストを記述します。
-   フロントエンドのコンポーネントには、VitestやPlaywright等を利用したテストを記述することを推奨します。

### 2.5. 依存関係管理

-   サーバーサイドのライブラリは `build.sbt` で管理します。
-   フロントエンドのライブラリは `package.json` で管理します。
-   ライブラリの追加・更新は、セキュリティ脆弱性やライセンスを考慮した上で行ってください。
