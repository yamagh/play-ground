# 5. コラム: ビルドの仕組み

このアプリケーションは、バックエンド（Play Framework）とフロントエンド（Svelte）で異なる技術スタックを使用しているため、ビルドのプロセスもそれぞれ独立しています。sbtとwebpackという2つのツールが連携して、最終的なアプリケーションを構築しています。

## 役割分担: sbt と webpack

- **sbt (The Scala Build Tool)**
  - **役割**: バックエンドのビルドとサーバーの実行を担当します。
  - **処理内容**:
    1.  `app` ディレクトリや `conf` ディレクトリにあるJava/Scalaのソースコード（`.java`, `.scala`）や設定ファイルをコンパイルします。
    2.  Play FrameworkのWebサーバーを起動します (`sbt run` コマンド)。
    3.  フロントエンドのアセットを配信する役割も担います。

- **webpack**
  - **役割**: フロントエンドのアセットのビルドを担当します。
  - **処理内容**:
    1.  `app/assets/svelte` ディレクトリにあるSvelteコンポーネント（`.svelte`）やTypeScript（`.ts`）ファイルを、ブラウザが解釈できる単一または複数のJavaScriptファイルに変換・結合（バンドル）します。
    2.  Tailwind CSSなどのCSSフレームワークを処理し、CSSファイルを生成します。
    3.  開発時には、HMR (Hot Module Replacement) 機能を提供し、コードの変更を即座にブラウザに反映させます (`npm run hmr` コマンド)。

## ビルド成果物の流れ

1.  **webpackによるビルド**:
    `npm run build` コマンド（または開発時の `npm run hmr`）を実行すると、webpackは `webpack.config.js` の設定に従って、`app/assets/svelte/screens` 配下にある各画面のエントリーポイントをビルドします。

2.  **成果物の出力**:
    ビルドされたJavaScriptファイルは、`target/web/public/main/javascripts/screens` ディレクトリに出力されます。例えば、`app/assets/svelte/screens/tasks/Page.svelte` は、`target/web/public/main/javascripts/screens/tasks/Page.js` のようなファイルとして出力されます。

3.  **Play Frameworkによる配信**:
    Play Frameworkは、`target/web/public/main` ディレクトリをクラスパスに含めています。これにより、このディレクトリ内のファイルは、Webアプリケーションの静的アセットとして扱われます。
    `views/screen.scala.html` の中で `@routes.Assets.versioned("javascripts/screens/" + screenName + ".js")` のような記述がありますが、これは `target/web/public/main` ディレクトリ内のJavaScriptファイルを指しています。

4.  **ブラウザでの実行**:
    ユーザーがブラウザでページにアクセスすると、Play FrameworkはHTMLを返し、そのHTMLに含まれる `<script>` タグが、`target/web/public/main` から配信されるビルド済みのJavaScriptファイルを読み込みます。そして、そのJavaScriptがSvelteコンポーネントを画面に描画します。

このように、webpackがフロントエンドのソースコードをPlay Frameworkの管理下にある `target` ディレクトリに出力し、Play Frameworkがそれを最終的にブラウザに配信するという連携によって、アプリケーション全体が動作しています。
