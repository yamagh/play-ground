# 13. コラム: H2データベースとコンソール

このプロジェクトは、開発環境のデータベースとして **H2 Database Engine** を使用しています。
H2はJavaで書かれた軽量なリレーショナルデータベースで、主に開発やテストの用途で広く使われています。

## H2データベースの特徴

- **インメモリモード**: H2は、データをディスクに書き込まず、メモリ上のみでデータを保持する「インメモリモード」で動作させることができます。これにより、非常に高速なデータの読み書きが可能になります。アプリケーションを再起動するとデータは消えますが、開発中のテストデータ投入などが容易になるというメリットがあります。
- **組み込みモード**: アプリケーションのプロセス内にデータベースを直接組み込んで動作させることができます。別途データベースサーバーをインストールして起動する必要がないため、プロジェクトのセットアップが非常に簡単になります。
- **ブラウザベースのコンソール**: H2には、Webブラウザからデータベースの状態を確認したり、SQLを直接実行したりできる「H2コンソール」という便利なツールが組み込まれています。

## H2の設定

このプロジェクトのH2データベースに関する設定は、`conf/application.conf` ファイルに記述されています。

**`conf/application.conf`**:
```
db.default.driver=org.h2.Driver
db.default.url="jdbc:h2:mem:play;DB_CLOSE_DELAY=-1"
```

- `jdbc:h2:mem:play`: このURLが、H2をインメモリモード (`mem`) で、`play` という名前のデータベースとして起動することを指定しています。
- `DB_CLOSE_DELAY=-1`: このオプションは、データベースへの接続がすべて閉じられても、メモリ上のデータを保持し続けるための設定です。これを設定しないと、リクエストのたびにデータが消えてしまう可能性があります。

## H2コンソールの使い方

開発中に「今、データベースの中身はどうなっているだろう？」「SQLを直接実行してデータを確認したい」と思うことがよくあります。
H2コンソールを使えば、これを簡単に行うことができます。

Play Frameworkは、開発モードでH2コンソールへの簡単なアクセスを提供しています。

1.  `sbt run` でアプリケーションを実行します。
2.  `conf/routes` ファイルを開き、H2コンソールを有効にするための以下の行のコメントを解除（先頭の `#` を削除）します。

    ```
    # GET    /console/h2   controllers.Assets.at(path="/public/h2", file="index.html")
    ```
    ↓
    ```
    GET    /console/h2   controllers.Assets.at(path="/public/h2", file="index.html")
    ```

3.  ファイルを保存すると、Playが自動的に変更をリロードします。
4.  ブラウザで `http://localhost:9000/console/h2` にアクセスします。
5.  H2のログイン画面が表示されます。**JDBC URL** の欄に、`application.conf` で設定した値 (`jdbc:h2:mem:play`) が入力されていることを確認し、「接続」ボタンをクリックします。
6.  データベースコンソールが開き、左側のツリーに `USERS` や `TASKS` などのテーブルが表示されます。テーブル名をクリックすると、`SELECT * FROM TASKS` が実行され、現在のテーブルの内容を直接確認できます。

H2コンソールは、APIが期待通りにデータを登録・更新・削除しているかを確認したり、複雑なクエリを試したりする際に非常に強力なツールです。開発が終わったら、セキュリティのためにroutesの行を再度コメントアウトしておくことを推奨します。
