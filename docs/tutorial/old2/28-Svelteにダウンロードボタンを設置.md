# 28. Svelteにダウンロードボタンを設置

バックエンドにCSVダウンロードAPIができたので、フロントエンドにダウンロードを開始するためのボタンを設置します。

APIからファイルを取得する場合、`fetch` を使ってJavaScriptでデータを取得し、それを動的に `Blob` オブジェクトに変換してダウンロードリンクを生成する、といった複雑な方法も可能です。
しかし、今回のケースのように、単純に特定のURLにアクセスすればファイルがダウンロードされるAPIの場合、もっとずっと簡単な方法で実装できます。

それは、**通常のHTMLの `<a>` (アンカー) タグを使う**方法です。

## `<a>` タグによるダウンロードの実装

`tasks/Page.svelte` に、CSVダウンロード用のリンクを追加しましょう。

**`app/assets/svelte/screens/tasks/Page.svelte`**:
```svelte
<!-- ... -->
<script lang="ts">
  // ...
  const csvDownloadUrl = "/api/tasks/csv";
</script>

<!-- 検索フォームなどの上部にボタンを配置 -->
<div class="mb-4">
  <a href={csvDownloadUrl} class="btn btn-secondary" download="tasks.csv">
    <i class="bi bi-download me-2"></i>
    Download CSV
  </a>
</div>

<!-- ... テーブル表示 ... -->
```

たったこれだけで、CSVダウンロード機能の実装は完了です。

### コードの解説

- `<a href={csvDownloadUrl} ...>`:
  `<a>` タグの `href` 属性に、前章で作成したCSVダウンロードAPIのエンドポイント (`/api/tasks/csv`) を指定します。
  ユーザーがこのリンクをクリックすると、ブラウザは `GET /api/tasks/csv` に対して通常のリクエストを送信します。
- `download="tasks.csv"`:
  `download` 属性は、`<a>` タグの重要な機能です。
  - この属性が存在すると、ブラウザは `href` で指定されたURLの遷移先を画面に表示しようとするのではなく、**リンク先のコンテンツをファイルとしてダウンロード**しようとします。
  - 属性に値を指定すると（例: `download="tasks.csv"`）、それがダウンロード時のデフォルトのファイル名になります。もしAPIのレスポンスヘッダー (`Content-Disposition`) でファイル名が指定されている場合は、そちらが優先されることが多いです。

## なぜ `fetch` を使わなくても良いのか？

`fetch` を使ったAPI呼び出しは、主に「ページ遷移なしにサーバーとデータをやり取りし、その結果を使って現在のページを動的に更新する」という目的（いわゆるAjax）のために使われます。

しかし、ファイルのダウンロードは、ブラウザが元々持っている機能です。
API側で `Content-Disposition: attachment` ヘッダーが正しく設定されていれば、そのURLにアクセスするだけで、ブラウザが自動的にダウンロード処理を開始してくれます。

そのため、Svelte (JavaScript) 側で特別な処理を実装する必要はなく、単純な `<a>` タグを置くだけで十分なのです。
このように、実現したい機能に応じて、最もシンプルで適切な方法を選択することが重要です。
