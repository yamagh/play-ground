# Play Framework & Svelte MPAチュートリアル

このチュートリアルでは、Play FrameworkとSvelteを使用してマルチページアプリケーション（MPA）を開発するための基本的な手順を学びます。
静的なページの作成から始め、データの表示、そしてデータの更新処理まで、段階的にアプリケーションを構築していきます。

## 前提事項

このチュートリアルは、特定のOSに依存しない内容ですが、コマンドの実行例はLinux/macOSのシェルを想定しています。Windowsの場合は適宜 `sbt.bat` などに読み替えてください。

## 目次

### 1. イントロダクション
- **1. [アーキテクチャ概要](./01-アーキテクチャ概要.md)**
  - メモ：このリポジトリの主要な技術スタック（Play, Svelte, Ebean, sbt, webpack）を紹介する。
  - メモ：主要フォルダの役割を解説する (`app/controllers`, `app/models`, `app/repository`, `app/assets/svelte`, `conf`, `public`)。
  - メモ：ブラウザからのリクエストが `conf/routes` を通じて `app/controllers` のアクションに渡され、`app/views/screen.scala.html` でレンダリングされ、最終的にSvelteコンポーネントがマウントされるまでの一連の流れを解説する。
- **2. [開発環境のセットアップ](./02-開発環境のセットアップ.md)**
  - メモ：`sbt run` でバックエンドのPlay Frameworkサーバーが起動すること、`npm run hmr` でフロントエンドのSvelteコードがリアルタイムでビルド・配信されること、という2つのプロセスの役割分担を明確にする。
  - メモ：HMR (Hot Module Replacement) の利点（ブラウザをリロードせずに画面が更新されること）に触れる。
- **3. [コラム: Play Frameworkとは](./03-コラム-Play-Frameworkとは.md)**
- **4. [コラム: Svelteとは](./04-コラム-Svelteとは.md)**
- **5. [コラム: ビルドの仕組み](./05-コラム-ビルドの仕組み.md)**
  - メモ：sbtがJava/Scalaのコンパイルとサーバー起動を担当し、webpackがSvelte/TypeScriptをブラウザ用のJavaScriptに変換する役割であることを解説する。
  - メモ：`target/web/public/main/javascripts/screens` にwebpackの成果物が出力され、Playがそれを配信する仕組みを解説する。

### 2. 静的なページを作成する
- **6. [Svelteコンポーネントの作成](./06-Svelteコンポーネントの作成.md)**
  - メモ：`app/assets/svelte/screens` 配下に新しい画面用のディレクトリと `Page.svelte` を作成する手順を解説する。
  - メモ：このリポジトリでは @app/views/screen.scala.html がエントリーポイントとマウントする要素を作成するため、個々の画面の実装ではエントリーポイントについて気にする必要はない。  
- **7. [Play Controllerとroutesの作成](./07-Play-Controllerとroutesの作成.md)**
  - メモ：`app/controllers/web` にControllerクラスを作成し、`views.html.screen.render("...")` を呼び出してSvelteコンポーネントを描画するアクションを実装する方法を解説する。
  - メモ：`conf/routes` に新しいエンドポイント（例: `GET /mypage ...`）を追加し、作成したControllerのアクションに紐付ける方法を解説する。
- **8. [標準レイアウトの適用](./08-標準レイアウトの適用.md)**
  - メモ：`LayoutSideMenu` と `PageContainer` コンポーネントをインポートし、ページ固有のコンテンツを囲むことで、アプリケーション全体のデザインを統一する方法を解説する。
  - メモ：props（プロパティ）を使って、ページタイトルやアクティブなメニュー項目をレイアウトコンポーネントに渡す方法を解説する。
- **9. [コラム: BootstrapとSveltestrap](./09-コラム-BootstrapとSveltestrap.md)**
- **10. [コラム: 画面部品のコンポーネント化](./10-コラム-画面部品のコンポーネント化.md)**

### 3. 一覧画面を作成する (Read)
- メモ：この章から、既存の `tasks` 画面の実装を参考に、バックエンドとフロントエンドを連携させた動的なアプリケーションを構築していく。
- **11. [DBマイグレーション](./11-DBマイグレーション.md)**
  - メモ：`conf/evolutions/default/` に連番のSQLファイルを作成する方法を解説する。
  - メモ：スキーマを変更する `# --- !Ups` と、変更を元に戻す `# --- !Downs` の重要性を解説する。
  - メモ：開発モードでブラウザからEvolutionsを適用する手順を解説する。
- **12. [コラム: データベースマイグレーションの重要性](./12-コラム-データベースマイグレーションの重要性.md)**
- **13. [コラム: H2データベースとコンソール](./13-コラム-H2データベースとコンソール.md)**
- **14. [データ取得APIの作成](./14-データ取得APIの作成.md)**
  - メモ：`models` (DBテーブルの表現), `repository` (DBアクセス), `services` (ビジネスロジック), `controllers/api` (HTTP I/O) という各層の役割分担（関心の分離）を解説する。
  - メモ：`TaskRepository` でEbeanを使ってデータベースからデータを取得するクエリの組み立て方を解説する。
- **15. [コラム: REST API設計の基本](./15-コラム-REST-API設計の基本.md)**
- **16. [コラム: Ebeanを使ったDB操作](./16-コラム-Ebeanを使ったDB操作.md)**
- **17. [SvelteからAPIを呼び出す](./17-SvelteからAPIを呼び出す.md)**
  - メモ：`onMount` (またはSvelte 5の`$effect`) を使って、コンポーネント表示時にAPIを呼び出す方法を解説する。
  - メモ：`screens/tasks/api.ts` のようにAPI呼び出しロジックを別ファイルにカプセル化する利点を解説する。
  - メモ：`@app/assets/svelte/utils/api.ts` の `get` ヘルパー関数の使い方を解説する。
- **18. [コラム: 非同期処理](./18-コラム-非同期処理.md)**
- **19. [応用: 検索とページネーション](./19-応用-検索とページネーション.md)**
  - メモ：API側: `TaskRepository` でリクエストパラメータに応じて `where()` 句や `setFirstRow`/`setMaxRows` を追加し、動的にクエリを変化させる方法を解説する。
  - メモ：Svelte側: 検索条件を `$state` で管理し、検索実行時にパラメータを付けてAPIを再呼び出しする流れを解説する。`Pagination.svelte` コンポーネントの使い方にも触れる。

### 4. 登録・更新フォームを作成する (Create/Update)
- **20. [データ登録・更新APIの作成](./20-データ登録・更新APIの作成.md)**
  - メモ：Controllerで `request.body().asJson()` を使ってリクエストボディを受け取り、`Json.fromJson()` でモデルオブジェクトに変換する方法を解説する。
  - メモ：`TaskRepository` で `save()` (登録) や `update()` (更新) を使ってデータを永続化する方法を解説する。
- **21. [コラム: DIの基本](./21-コラム-DIの基本.md)**
  - メモ：`@Inject` アノテーションの役割と、Play Frameworkがどのように依存性を自動的に注入してくれるのかを解説する。
- **22. [Svelteで登録・更新フォームを作成](./22-Svelteで登録・更新フォームを作成.md)**
  - メモ：`task-edit/Page.svelte` を例に、URLのIDの有無で新規作成と編集のモードを切り替える方法を解説する。
  - メモ：`bind:value` を使ってフォームの入力とSvelteの `$state` を双方向バインディングする方法を解説する。
  - メモ：`@app/assets/svelte/utils/api.ts` の `post` と `put` ヘルパー関数の使い方を解説する。
- **23. [フィードバックメッセージの表示](./23-フィードバックメッセージの表示.md)**
  - メモ：SvelteのStore機能を使った `@app/assets/svelte/stores/message.ts` の仕組みを解説する。
  - メモ：API呼び出し成功後に `message.success(...)` を呼び出し、`MessageContainer.svelte` がそれを検知して画面にメッセージを表示する流れを解説する。
- **24. [エラーハンドリング](./24-エラーハンドリング.md)**
  - メモ：`@app/assets/svelte/utils/safeRun.ts` が `try...catch` をラップし、API呼び出しでエラーが発生した際に自動でエラーメッセージを表示する仕組みを解説する。

### 5. 削除機能を追加する (Delete)
- **25. [データ削除APIの作成](./25-データ削除APIの作成.md)**
  - メモ：`TaskRepository` で `delete()` を使ってデータを削除するAPIの実装方法を解説する。
- **26. [Svelteから削除機能を呼び出す](./26-Svelteから削除機能を呼び出す.md)**
  - メモ：`window.confirm()` でユーザーに確認ダイアログを表示する方法を解説する。
  - メモ：フォーム内のボタンで `event.preventDefault()` が必要なケース（フォーム全体の送信を防ぐため）について解説する。

### 6. 応用：CSVダウンロード機能
- **27. [CSVダウンロードAPIの作成](./27-CSVダウンロードAPIの作成.md)**
  - メモ：`@app/services/CsvService.java` を使ってデータリストからCSV文字列を生成する方法を解説する。
  - メモ：PlayのControllerで `Content-Disposition` ヘッダーを設定し、ブラウザにファイルをダウンロードさせる方法を解説する。
- **28. [Svelteにダウンロードボタンを設置](./28-Svelteにダウンロードボタンを設置.md)**
  - メモ：`<a>` タグの `href` にAPIエンドポイントを指定し、`download` 属性を付与するシンプルな実装方法を解説する。

### 7. まとめ
- **29. [学習の振り返りと次のステップ](./29-学習の振り返りと次のステップ.md)**
  - メモ：チュートリアルで学んだCRUD一連の流れを振り返る。
  - メモ：このリポジトリに含まれる認証機能 (`AuthenticatedAction.java`) や、より複雑なコンポーネント (`SearchBoxWithFilters.svelte`) など、次に学ぶべきトピックを紹介する。

### 付録
- **30. [付録: Svelte Runesを使ったデバッグ](./30-付録-Svelte-Runesを使ったデバッグ.md)**
- **31. [付録: Play Framework開発Tips](./31-付録-Play-Framework開発Tips.md)**
