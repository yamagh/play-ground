const fs = require('fs');
const path = require('path');

const inputFile = path.join(__dirname, '../conf/messages.ja');
const outputFile = path.join(__dirname, '../app/assets/svelte/generated/messages.ts');

const content = fs.readFileSync(inputFile, 'utf-8');
const lines = content.split('\n').filter(line => line.trim() !== '' && !line.startsWith('#'));

const messages = {};
lines.forEach(line => {
  const [key, ...valueParts] = line.split('=');
  if (key && valueParts.length > 0) {
    messages[key.trim()] = valueParts.join('=').trim();
  }
});

const tsContent = `// This file is auto-generated by scripts/generate-messages.js
// Do not edit this file directly.

export const messages = ${JSON.stringify(messages, null, 2)} as const;

export type MessageKey = keyof typeof messages;
`;

// 出力先ディレクトリが存在しない場合は作成
const outputDir = path.dirname(outputFile);
if (!fs.existsSync(outputDir)) {
  fs.mkdirSync(outputDir, { recursive: true });
}

fs.writeFileSync(outputFile, tsContent, 'utf-8');
console.log(`✅ Messages generated at ${outputFile}`);
